= ISO/TC 211 XML Schemas

image:https://github.com/ISO-TC211/schemas/workflows/build/badge.svg["XSD documentation build status", link="https://github.com/ISO-TC211/schemas/actions?workflow=build"]

image:https://github.com/ISO-TC211/schemas/workflows/deploy/badge.svg["Deploy status", link="https://github.com/ISO-TC211/schemas/actions?workflow=deploy"]

== Introduction

This is the official repository of ISO/TC 211 XML Schemas.

Jointly managed by ISO/TC 211/XMG and Ribose.


== XSD documentation pages

XSD documentation pages are generated using the `build` workflow.

The `schemas.yml` file controls which schemas (identified by path)
should generate XSD documentation. It can be maintained manually or using the `hrma` command-line tool (see <<Schema manifest management>>).

The resulting documentation per schema will be generated in the path:

* HTML page: `_site/{schema-path}/{xsd-name}/index.html`
* Diagrams: `_site/{schema-path}/{xsd-name}/diagrams/*.svg`


== Schema manifest management

The repository includes a command-line tool called `hrma` (Harmonized Resources Maintenance Agency) to manage the schemas manifest file (`schemas.yml`) and build documentation. This tool allows for automatic discovery and registration of schema files and generation of documentation.

=== Requirements

* Ruby (2.5 or later)
* Dependencies installation (choose one):
  - Individual: `gem install thor rake`
  - Using Bundler: `bundle install`
  - Build and install gem: `gem build hrma.gemspec && gem install hrma-*.gem`
* External dependencies:
  - Java (for generating diagrams)
  - xsltproc (for generating documentation)

=== Usage

[source,sh]
----
# Update schemas.yml with all 3-character XSD and JSON files
./bin/hrma schemas manifest update

# List all schemas in the manifest file
./bin/hrma schemas manifest list

# List schemas with filtering options
./bin/hrma schemas manifest list --type xsd
./bin/hrma schemas manifest list --doc 19115

# Verify all schemas in the manifest exist
./bin/hrma schemas manifest validate
----

The tool supports both XSD and JSON schemas and organizes them in the schemas.yml file according to their type.

== Building documentation

[source,sh]
----
# Generate documentation for schemas
./bin/hrma build documentation

# Generate documentation with custom cache directory
./bin/hrma build documentation --cache-dir=/path/to/cache

# Remove generated documentation
./bin/hrma build clean

# Remove generated documentation and downloaded tools
./bin/hrma build distclean

# Remove generated documentation and global cache
./bin/hrma build distclean --global-cache
----

== Configuration

The `hrma` tool can be configured in several ways:

=== Cache Directory

The cache directory is where downloaded tools are stored. By default, it's `~/.hrma/cache`.

You can set it in three ways (in order of precedence):

. Command-line option: `--cache-dir=/path/to/cache`
. Environment variable: `HRMA_CACHE_DIR=/path/to/cache ./bin/hrma ...`
. Configuration file: `~/.hrma/config.yml`

To manage configuration:

[source,sh]
----
# Get current cache directory
./bin/hrma config get cache_dir

# Set cache directory
./bin/hrma config set cache_dir /path/to/cache
----

== Code organization

The `hrma` tool is organized into several components:

=== Command-line interface

* `bin/hrma` - Main executable script
* `lib/hrma/cli.rb` - Thor-based CLI implementation
* `lib/hrma/commands/*.rb` - Individual command implementations

=== Build system

* `lib/hrma/build/document_generator.rb` - Main class for generating documentation
* `lib/hrma/build/ractor_document_processor.rb` - Processor for XSD files that can run within a Ractor
* `lib/hrma/build/documentation.rb` - Module with documentation generation utilities
* `lib/hrma/build/tools.rb` - Handles downloading and setting up external tools
* `lib/hrma/build/cleaner.rb` - Handles cleaning generated files

=== Configuration

* `lib/hrma/config.rb` - Configuration management
* `lib/hrma/version.rb` - Version information

=== Parallel processing

The tool supports parallel processing using Ruby's Ractor feature (available in
Ruby 3.0+). This significantly speeds up documentation generation for large
numbers of schema files.

To disable parallel processing:

[source,sh]
----
# Disable parallel processing
HRMA_DISABLE_RACTORS=1 ./bin/hrma build documentation
----
